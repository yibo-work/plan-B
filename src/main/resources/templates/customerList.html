<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>客户列表</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
    <link rel="stylesheet" th:href="@{/css/xadmin.css}">
    <link rel="stylesheet" th:href="@{/css/font.css}">
    <script charset="utf-8" th:src="@{/js/jquery.min.js}" type="text/javascript"></script>
    <script charset="utf-8" th:src="@{/layui/layui.js}" type="text/javascript"></script>
    <script charset="utf-8" th:src="@{/js/xadmin.js}" type="text/javascript"></script>
    <script charset="utf-8" th:src="@{/js/vue.js}" type="text/javascript"></script>
</head>

<body>
<div class="x-nav">
            <span class="layui-breadcrumb">
                <a target="_top" th:href="@{/index}">首页</a>
            </span>
    <a class="layui-btn layui-btn-small" onclick="location.reload()"
       style="line-height:1.6em;margin-top:3px;float:right" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
    </a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12" id="vmCustomer">
            <div class="layui-card">
                <div class="layui-card-body">
                    <table class="layui-table layui-form">
                        <thead>
                        <tr>
                            <th>
                                <input lay-filter="checkAll" lay-skin="primary" name="checkAll" type="checkbox">
                            </th>
                            <th>公司名称</th>
                            <th>负责人</th>
                            <th>联系电话</th>
                            <th>公司地址</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="customer,i in customerList">
                            <td>
                                <input :data-name="customer.companyName" :value="customer.id" lay-skin="primary"
                                       name="customerId"
                                       type="checkbox">
                            </td>
                            <td v-text="customer.companyName"></td>
                            <td v-text="customer.man"></td>
                            <td v-text="customer.phone"></td>
                            <td v-text="customer.address"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>
<div style="position: sticky; bottom: 30px;background: white;padding: 10px">
    <div style="margin: 10px auto; width: 300px;">
        <div style="width: 200px; margin: -5px auto -10px">
            <button class="layui-btn" lay-filter="add" lay-submit="" style="width:75px;margin-right: 20px">
                提交
            </button>
            <button class="layui-btn layui-btn-primary" onclick="xadmin.close();" style="width:75px;">
                返回
            </button>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">

    layui.use(['form'], function () {
        var form = layui.form,
            layer = layui.layer;

        form.on('checkbox(checkAll)', function (data) {
            var id = data.value;
            //这里实现勾选
            $('input[name=customerId]').each(function (index, item) {
                item.checked = data.elem.checked;
            });
            form.render('checkbox');

        });


        //监听提交
        form.on('submit(add)',
            function (data) {

                // 获取选中的值
                var check_arr = [];
                var companyName_arr = [];
                $('input[name=customerId]:checked').each(function () {
                    check_arr.push($(this).val());
                    companyName_arr.push($(this).attr("data-name"));
                });

                if (check_arr.length === 0) {
                    layer.msg("还未选择客户！", {icon: 7, time: 1500});
                    return false;
                }
                //注意：parent 是 JS 自带的全局对象，可用于操作父页面
                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                //给父页面传值
                console.info(companyName_arr)
                parent.$('#customerList').val(companyName_arr);
                parent.$('#customerIds').val(check_arr);
                parent.layer.close(index);
                return false;
            });

    });

    vm = new Vue({
        el: "#vmCustomer",
        data: {
            customerList: {}
        },
        methods: {
            getPage: function () {
                var _this = this;
                $.getJSON("/customer/list", function (result) {
                    _this.customerList = result.data;
                });
            }
        },
        created: function () {
            this.getPage();
        }
    });

</script>
</html>